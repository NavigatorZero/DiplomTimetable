{% block title %}Вложенный титл{% endblock %}
{% block content %}

<div class="form-group col-md-2">

    <label>Выберите дату занятий</label>

    <div class="input-group date">
        <input type="text" class="form-control datepicker" value="{% now 'Y-m-d' %}"
               data-date-format="yyyy-mm-dd">
    </div>

    <form action="{%url 'Main_list' %}" method="post">
        {% csrf_token %}
        <button type="submit" name="erase" id="erase">Стереть расписание</button>
        <button type="submit" name="fill" id="fill">Составить расписание</button>
    </form>
</div>

{% include "main_table.html" %}
<script>
    $(document).ready(function () {

        $(".datepicker").datepicker({autoclose: true});
        var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();

        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }

        $(".datepicker").change(function () {
            data = $('.datepicker').datepicker().val()
            $.ajax({
                method: "POST",
                url: "{%url 'Main_list'%}",
                dataType: "text",
                data: {
                    "scheduleDay": data,
                },
                beforeSend: function (xhr, settings) {
                    // if not safe, set csrftoken
                    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                },
                success: function (data) {
                    $(".main_table").html(data);

                    console.log('ssucces')
                },
                error: function (er) {
                    console.log(er);
                }
            });
        });
    });
</script>
{% endblock %}
</div>