<!DOCTYPE html>
<html>
<head>
    {% load static %}
    <title>{% block title %}{% endblock %}</title>

    <link href="{% static 'css/bootstrap.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/bootstrap-grid.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/main.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/datepicker.css' %}" rel="stylesheet" type="text/css">

    <script src="https://kit.fontawesome.com/f17ef1e39c.js" crossorigin="anonymous"></script>
    <script src="{% static 'js/jquery-3.4.1.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/bootstrap.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/bootstrap-datepicker.js' %}" type="text/javascript"></script>
</head>
<body>
<div class="head">
    <img src="{% static 'img/logo_uisi.png' %}">

    {% if user.is_authenticated %}
    <h3>Привет! {{user.last_name}} {{user.first_name}}</h3>
    {%if user.is_staff%}
    <button class="btn btn-secondary float-sm-right" id="TeacherTable" data-id = '{{user.id}}'
            data-toggle="modal" data-target="#exampleModalCenter">Выбор времени занятий
    </button>

    {% include "modal.html" %}

    {%endif%}
    <form action="{%url 'Main_list' %}" method="post">
        {% csrf_token %}
        <input type="hidden" name="logout">
        <button class="btn btn-danger float-sm-right">Выйти</button>
    </form>
    {% else %}
    <button class="btn btn-primary float-sm-right" id="login">Войти</button>
    {%endif%}

    <a class="btn btn-primary" href="/admin/">admin panel</a>
    <div class="float-sm-right" id="login_form" style="visibility: hidden">
        <form action="{%url 'Main_list' %}" method="post">
            {% csrf_token %}
            <div class="form-group">
                <label for="InputEmail">Email address</label>
                <input type="email" class="form-control" id="InputEmail" aria-describedby="emailHelp"
                       placeholder="Enter email" name="email">
                <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone
                    else.</small>
            </div>
            <div class="form-group">
                <label for="InputPassword">Password</label>
                <input type="password" class="form-control" id="InputPassword" placeholder="Password"
                       name="password">
            </div>
            <button type=submit class="btn-primary">Войти</button>
        </form>
    </div>
</div>

<div id="content">
    {% block content %}
    {% include "list.html" %}
    {% endblock %}
</div>
<div class="footer">
    <div id="sidebar">
        <h2>Все права разрешены</h2>
        <p>Это футер.</p>
        <div>
        </div>
    </div>
</div>
</body>
</html>
<script>
    $(document).ready(function () {

          function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }

        $("#login").click(function () {
            if ($("#login_form").css("visibility") === "visible") {
                $("#login_form").css("visibility", "hidden");
            } else {
                $("#login_form").css("visibility", "visible");
            }
        })


        $("#TeacherTable").click(function () {
            userId = $(this).data("id");
            var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();
            $.ajax({
                method: "POST",
                url: "{%url 'Main_list'%}",
                dataType: "text",
                data: {
                    'userID': userId
                },
                beforeSend: function (xhr, settings) {
                    // if not safe, set csrftoken
                    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                },
                success: function (data) {
                      $(".popup_table").html(data);
                    $('#exampleModalCenter').modal('show')
                    console.log('ssucces')
                },
                error: function (er) {
                    console.log(er);
                }
            });
        });

    });
</script>
